<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bar Chart - Books by Genre</title>
    <!-- Load the P5.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        body {
            font-family: Georgia, serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
        }
        a {
            margin-bottom: 20px;
            color: #3498db;
        }
    </style>
</head>
<body>
    <h1>Bar Chart: Books by Genre</h1>
    <a href="a2.html">‚Üê Back to A2</a>
    
    <script>
        let table;
        let genreCounts = {};
        let genres = [];
        let counts = [];
        let maxCount = 0;

        // Preload runs before setup - load the CSV here
        function preload() {
            table = loadTable('data/novels.csv', 'csv', 'header');
        }

        function setup() {
            createCanvas(1000, 600);
            
            // Count books per genre
            for (let i = 0; i < table.getRowCount(); i++) {
                let genre = table.getString(i, 'genre');
                
                // Clean up the genre name
                if (genre === '' || genre === 'na') {
                    genre = 'Other';
                }
                
                // Count it
                if (genreCounts[genre]) {
                    genreCounts[genre]++;
                } else {
                    genreCounts[genre] = 1;
                }
            }
            
            // Convert to arrays for easier plotting
            for (let genre in genreCounts) {
                genres.push(genre);
                counts.push(genreCounts[genre]);
                if (genreCounts[genre] > maxCount) {
                    maxCount = genreCounts[genre];
                }
            }
            
            // Sort by count (descending)
            let combined = genres.map((g, i) => ({ genre: g, count: counts[i] }));
            combined.sort((a, b) => b.count - a.count);
            genres = combined.map(item => item.genre);
            counts = combined.map(item => item.count);
        }

        function draw() {
            background(255);
            
            // Chart dimensions
            let marginLeft = 120;
            let marginRight = 50;
            let marginTop = 60;
            let marginBottom = 150;
            let chartWidth = width - marginLeft - marginRight;
            let chartHeight = height - marginTop - marginBottom;
            
            // Draw title
            fill(0);
            textSize(20);
            textAlign(CENTER);
            text('Number of Books by Genre (Top 500 Novels)', width / 2, 35);
            
            // Draw axes
            stroke(0);
            strokeWeight(2);
            // Y-axis
            line(marginLeft, marginTop, marginLeft, height - marginBottom);
            // X-axis
            line(marginLeft, height - marginBottom, width - marginRight, height - marginBottom);
            
            // Y-axis label
            push();
            translate(30, height / 2);
            rotate(-PI / 2);
            textSize(14);
            textAlign(CENTER);
            fill(0);
            noStroke();
            text('Count', 0, 0);
            pop();
            
            // X-axis label
            textSize(14);
            textAlign(CENTER);
            fill(0);
            noStroke();
            text('Genre', width / 2, height - 20);
            
            // Calculate bar width
            let barWidth = chartWidth / genres.length - 10;
            
            // Draw Y-axis tick marks and labels
            let numTicks = 5;
            let tickInterval = Math.ceil(maxCount / numTicks / 10) * 10; // Round to nearest 10
            
            textSize(12);
            textAlign(RIGHT, CENTER);
            fill(0);
            noStroke();
            
            for (let i = 0; i <= numTicks; i++) {
                let value = i * tickInterval;
                let y = map(value, 0, numTicks * tickInterval, height - marginBottom, marginTop);
                
                // Tick mark
                stroke(0);
                strokeWeight(1);
                line(marginLeft - 5, y, marginLeft, y);
                
                // Grid line (light gray)
                stroke(220);
                line(marginLeft, y, width - marginRight, y);
                
                // Label
                noStroke();
                text(value, marginLeft - 10, y);
            }
            
            // Draw bars and X-axis labels
            for (let i = 0; i < genres.length; i++) {
                let x = marginLeft + i * (chartWidth / genres.length) + 5;
                let barHeight = map(counts[i], 0, numTicks * tickInterval, 0, chartHeight);
                let y = height - marginBottom - barHeight;
                
                // Draw bar
                fill(70, 130, 180); // Steel blue color
                stroke(50, 100, 150);
                strokeWeight(1);
                rect(x, y, barWidth, barHeight);
                
                // Draw count on top of bar
                fill(0);
                noStroke();
                textSize(10);
                textAlign(CENTER);
                text(counts[i], x + barWidth / 2, y - 5);
                
                // X-axis tick mark
                stroke(0);
                strokeWeight(1);
                line(x + barWidth / 2, height - marginBottom, x + barWidth / 2, height - marginBottom + 5);
                
                // X-axis label (rotated)
                push();
                translate(x + barWidth / 2, height - marginBottom + 15);
                rotate(PI / 4); // 45 degree rotation
                textAlign(LEFT, CENTER);
                textSize(11);
                fill(0);
                noStroke();
                text(genres[i], 0, 0);
                pop();
            }
            
            noLoop(); // Static chart - no need to keep redrawing
        }
    </script>
</body>
</html>
